version: 1.0
name: metrics-apb
description: Installs a metrics service based on Prometheus and Grafana
bindable: True
async: optional
tags:
  - mobile-service
  - mobile-client-enabled
metadata:
  displayName: Mobile Metrics
  imageUrl: "data:image/png;base64,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"
  documentationUrl: "https://docs.aerogear.org/external/apb/metrics.html"
  providerDisplayName: "Red Hat, Inc."
  serviceName: metrics
plans:
  - name: default
    description: This plan should be used in most use cases
    free: True
    metadata:
      displayName: Default
      mobileclient_bind_parameters_data:
        - '{"name": "CLIENT_ID", "value": "metadata.name", "type": "path"}'
    parameters:
      - name: GRAFANA_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Grafana Storage Size (Gb)
      - name: PROMETHEUS_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Prometheus Storage Size (Gb)
      - name: POSTGRES_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Postgres Storage Size (Gb)
      - name: POSTGRES_USER
        description: Username that will be used to connect to postgres ('user' will be used if blank)
        default: user
        type: string
        required: False
        title: Postgres User
      - name: POSTGRES_PASSWORD
        description: Password to connect to Postgres (generated if blank)
        type: string
        required: False
        title: Postgres Password
    bind_parameters:
      - name: CLIENT_ID
        required: True
        title: Mobile Client ID
        type: string
  - name: custom
    description: This plan can be used if images need to be customized
    free: True
    metadata:
      displayName: User Specified
      mobileclient_bind_parameters_data:
        - '{"name": "CLIENT_ID", "value": "metadata.name", "type": "path"}'
    parameters:
      - name: GRAFANA_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Grafana Storage Size (Gb)
      - name: PROMETHEUS_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Prometheus Storage Size (Gb)
      - name: POSTGRES_STORAGE_SIZE
        required: True
        default: 10
        type: number
        title: Postgres Storage Size (Gb)
      - name: POSTGRES_USER
        description: Username that will be used to connect to postgres ('user' will be used if blank)
        default: user
        type: string
        required: False
        title: Postgres User
      - name: POSTGRES_PASSWORD
        description: Password to connect to Postgres (generated if blank)
        type: string
        required: False
        title: Postgres Password
      - name: custom_prometheus_image
        title: Prometheus container image
        description: The image to use for the Prometheus server (You shouldn't need to change this)
        default: docker.io/openshift/origin-prometheus:v3.11
        type: string
        required: True
      - name: custom_grafana_image
        title: Grafana container image
        description: The image to use for the Grafana server (You shouldn't need to change this)
        default: docker.io/grafana/grafana:5.2.3
        type: string
        required: True
      - name: custom_api_server_image
        title: App Metrics container image
        description: The image to use for the App Metrics server (You shouldn't need to change this)
        default: docker.io/aerogear/aerogear-app-metrics:0.0.13
        type: string
        required: True
      - name: custom_postgres_image
        title: PostgreSQL container image
        description: The image to use for the PostgreSQL database server (You shouldn't need to change this)
        default: docker.io/centos/postgresql-96-centos7:9.6
        type: string
        required: True
      - name: custom_proxy_image
        title: OpenShift OAuth Proxy container image
        description: The image to use for the OAuth Proxy (You shouldn't need to change this)
        default: docker.io/openshift/oauth-proxy:v1.1.0
        type: string
        required: True
    bind_parameters:
      - name: CLIENT_ID
        required: True
        title: Mobile Client ID
        type: string
